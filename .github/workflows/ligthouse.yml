name: Lightouse

on:
    schedule:
        - cron: "0 * * * 1"

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: adambirds/docker-compose-action@v1.3.0
              env:
                  DB_HOST: ${{ secrets.DB_HOST }}
                  DB_USER: ${{ secrets.DB_USER }}
                  DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
                  DB_NAME: ${{ secrets.DB_NAME }}
                  DB_DATABASE: ${{ secrets.DB_DATABASE }}
                  NODE_ENV: development
              with:
                  compose-file: "./docker-compose.yml"
                  down-flags: "--volumes"
                  services: |
                      api
                      db
                  test-container: api
                  test-command: "lightouse http://localhost:3000 --output json --output-path ./lighthouse.json"
            - uses: actions/upload-artifact@v2
              with:
                  name: lighthouse
                  path: ./lighthouse.json
